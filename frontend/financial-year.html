<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>السنة المالية - HNU</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="modules.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <img src="logo.png" alt="HNU logo" class="brand-logo" />
      <span class="brand-text">HNU — النظام المحاسبي</span>
    </div>
  </header>
  <main class="container">
    <section class="module-card">
      <h2>إعداد السنة المالية</h2>
      <form id="form-year">
        <label>السنة المالية (مثال: 2024/2025)<br><input name="year" id="year"></label>
        <label>تاريخ البداية<br><input name="start" id="start" type="date"></label>
        <label>تاريخ النهاية<br><input name="end" id="end" type="date"></label>
        <div style="margin-top:10px">
          <button class="primary" id="btn-activate">تفعيل / تحديث السنة</button>
          <button id="btn-close" class="muted-btn" type="button">إغلاق السنة</button>
        </div>
        <p id="year-status" style="margin-top:10px"></p>
      </form>
    </section>
  </main>
  <script src="admin-modules.js"></script>
  <script>
    async function load(){
      const res = await AdminAPI.apiFetch('/api/settings/financial-year',{method:'GET'});
      const y = res.year;
      document.getElementById('year').value=y.year;document.getElementById('start').value=y.start;document.getElementById('end').value=y.end;document.getElementById('year-status').textContent='الحالة: '+y.status;
    }
    document.getElementById('form-year').addEventListener('submit',async function(e){
      e.preventDefault();
      const form = Object.fromEntries(new FormData(e.target).entries());
      const res = await AdminAPI.apiFetch('/api/settings/financial-year',{method:'POST',body:JSON.stringify(form)});
      if(res.success){alert('تم الحفظ');load()} else alert(res.error||'خطأ');
    })
    document.getElementById('btn-close').addEventListener('click',async function(){
      if(!confirm('تأكيد إغلاق السنة؟')) return; const res = await AdminAPI.apiFetch('/api/settings/financial-year',{method:'POST',body:JSON.stringify({status:'closed'})}); if(res.success) alert('تم الإغلاق'); load();
    })
    load();
  </script>
</body>
</html>